#Make a kraken-report style from Kaiju to import it to phyloseq

kraken-report --db ../../programas/kraken2_db/fungi path/to/kaiju.out > path/to/kaiju.tsv


for f in `ls ../data/filter/nonhost/ | grep ".fastq" | sed "s/_p_filtered.fastq//" | sed "s/_R1_filtered.fastq//" | sed "s/_R2_filtered.fastq//"| sed "s/_cat.fastq//" | uniq`;
do



cat *_cat_kaiju.tsv > cat_kaiju.tsv
cat *_R1_kaiju.tsv > R1_kaiju.tsv
cat *_R2_kaiju.tsv > R2_kaiju.tsv
cat *_paired_kaiju.tsv > paired_kaiju.tsv




#Make a mpa report style to easier export it to R
for f in `ls ../data/filter/nonhost/ | grep ".fastq" | sed "s/_p_filtered.fastq//" | sed "s/_R1_filtered.fastq//" | sed "s/_R2_filtered.fastq//"| sed "s/_cat.fastq//" | uniq`;
do kreport2mpa.py -r ../data/reports/kraken2/${f}_k2_contigs_bracken_species.report -o ../data/reports/kraken2/${f}_k2_contigs_bracken.txt --no-intermediate-ranks --read_count --display-header;
done

#Combine
combine_mpa.py -i ../data/reports/kraken2/*_k2_contigs_bracken.txt -o ../data/reports/kraken2/combined_sp_contigs_bracken.txt

grep -E "(s__)|(#Classification)" ../data/reports/kraken2/combined_sp_contigs_bracken.txt > ../data/reports/kraken2/contigs_kraken2.txt
